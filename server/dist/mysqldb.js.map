{"version":3,"sources":["../mysqldb.js"],"names":["PROD_DB","TEST_DB","TEST_MODE","PROD_MODE","state","pool","mode","connect","done","createPool","host","HOST","user","DBUSER","password","DBPASSWORD","database","sql"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;AAGA,IAAMA,UAAU,aAAhB;AACA,IAAMC,UAAU,aAAhB;;AAEO,IAAMC,gCAAY,WAAlB;AACA,IAAMC,gCAAY,WAAlB;;AAEP,IAAMC,QAAQ;AACZC,QAAM,IADM;AAEZC,QAAM;AAFM,CAAd;;AAKO,IAAMC,4BAAU,SAAVA,OAAU,CAACD,IAAD,EAAOE,IAAP,EAAgB;AACrCJ,QAAMC,IAAN,GAAa,gBAAMI,UAAN,CAAiB;AAC5BC,UAAM,aAAIC,IADkB;AAE5BC,UAAM,aAAIC,MAFkB;AAG5BC,cAAU,aAAIC,UAHc;AAI5BC,cAAUV,SAASH,SAAT,GAAqBH,OAArB,GAA+BC;AAJb,GAAjB,CAAb;;AAOAG,QAAME,IAAN,GAAaA,IAAb;AACAE;AACD,CAVM;;AAYA,IAAMS,oBAAM,SAANA,GAAM,GAAM;AACvB,SAAOb,MAAMC,IAAb;AACD,CAFM;;AAIP;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA","file":"mysqldb.js","sourceRoot":"./src","sourcesContent":["import mysql from \"mysql\";\r\nimport async from \"async\";\r\nimport { env } from \"./envVars\";\r\n\r\n\r\nconst PROD_DB = \"copelandeng\";\r\nconst TEST_DB = \"copelandeng\";\r\n\r\nexport const TEST_MODE = \"test_mode\";\r\nexport const PROD_MODE = \"prod_mode\";\r\n\r\nconst state = {\r\n  pool: null,\r\n  mode: null,\r\n}\r\n\r\nexport const connect = (mode, done) => {\r\n  state.pool = mysql.createPool({\r\n    host: env.HOST,\r\n    user: env.DBUSER,\r\n    password: env.DBPASSWORD,\r\n    database: mode === PROD_MODE ? PROD_DB : TEST_DB\r\n  });\r\n\r\n  state.mode = mode;\r\n  done();\r\n}\r\n\r\nexport const sql = () => {\r\n  return state.pool;\r\n}\r\n\r\n// export const fixtures = (data) => {\r\n//   const pool = state.pool;\r\n//   if (!pool) return done(new Error('Missing database connection.'));\r\n\r\n//   const names = Object.keys(data.tables);\r\n//   async.each(names, function(name, cb) {\r\n//     async.each(data.tables[name], function(row, cb) {\r\n\r\n//       const keys = Object.keys(row);\r\n//       const values = keys.map(function(key) { return \"'\" + row[key] + \"'\" });\r\n\r\n//       pool.query('INSERT INTO ' + name + ' (' + keys.join(',') + ') VALUES (' + values.join(',') + ')', cb)\r\n//     }, cb);\r\n//   }, done);\r\n// }\r\n\r\n// export const drop = function(tables, done) {\r\n    \r\n//   const pool = state.pool;\r\n//   if (!pool) return done(new Error('Missing database connection.'));\r\n\r\n//   async.each(tables, function(name, cb) {\r\n//     pool.query('DELETE * FROM ' + name, cb);\r\n//   }, done);\r\n// }"]}